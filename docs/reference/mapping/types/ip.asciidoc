[[ip]]
=== IP 数据类型

`ip` 字段可以索引或存储为 https://en.wikipedia.org/wiki/IPv4[IPv4] 或
https://en.wikipedia.org/wiki/IPv6[IPv6] 地址。

[source,js]
--------------------------------------------------
PUT my_index
{
  "mappings": {
    "_doc": {
      "properties": {
        "ip_addr": {
          "type": "ip"
        }
      }
    }
  }
}

PUT my_index/_doc/1
{
  "ip_addr": "192.168.1.1"
}

GET my_index/_search
{
  "query": {
    "term": {
      "ip_addr": "192.168.0.0/16"
    }
  }
}
--------------------------------------------------
// CONSOLE
// TESTSETUP

NOTE: 你也可以使用 <<range,ip_range 数据类型>>在一个字段中存储 ip 范围。

[[ip-params]]
==== `ip` 字段的参数

`ip` 字段接受以下参数：

[horizontal]

<<mapping-boost,`boost`>>::

    映射字段级别查询时间提升。接受一个浮点数，默认为 `1.0` 。

<<doc-values,`doc_values`>>::

    字段是否应该以多列的方式存储在磁盘上，以便以后可以将其用于排序，聚合或脚本？接受 `true` （默认）或 `false` 。

<<mapping-index,`index`>>::

    字段是否可搜索？接受 `true` （默认）或 `false` 。

<<null-value,`null_value`>>::

    接受上面列出的任何 IPv4 值。该值被替换为任何显式空值。默认为 `null` ，意味着该字段被视为缺失。
    

<<mapping-store,`store`>>::

    字段值是否应与 <<mapping-source-field,`_source`>> 字段分开存储和检索。接受 `true` 或 `false` （默认）。

==== 查询 `ip` 字段

查询 ip 地址的最常见方法是使用 
https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation[CIDR] 符号： `[ip_address]/[prefix_length]` 。
例如：

[source,js]
--------------------------------------------------
GET my_index/_search
{
  "query": {
    "term": {
      "ip_addr": "192.168.0.0/16"
    }
  }
}
--------------------------------------------------
// CONSOLE

or

[source,js]
--------------------------------------------------
GET my_index/_search
{
  "query": {
    "term": {
      "ip_addr": "2001:db8::/48"
    }
  }
}
--------------------------------------------------
// CONSOLE

注意冒号是 <<query-dsl-query-string-query,`query_string`>> 查询的特殊字符，
所以 ipv6 地址需要被转义。最简单的方法是给搜索值加上引号：

[source,js]
--------------------------------------------------
GET my_index/_search
{
  "query": {
    "query_string" : {
      "query": "ip_addr:\"2001:db8::/48\""
    }
  }
}
--------------------------------------------------
// CONSOLE
