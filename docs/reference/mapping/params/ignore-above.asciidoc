[[ignore-above]]
=== `ignore_above`

长于 `ignore_above` 配置的字符串不会被索引和存储。
对于字符串数组， `ignore_above` 将分别应用于每个数组元素，并且不会索引或存储长于 `ignore_above` 的字符串元素。

注意：如果启用了后者，那么所有字符串/数组元素仍将出现在 `_source` 字段中，这是 Elasticsearch 中的默认值。

[source,js]
--------------------------------------------------
PUT my_index
{
  "mappings": {
    "_doc": {
      "properties": {
        "message": {
          "type": "keyword",
          "ignore_above": 20 <1>
        }
      }
    }
  }
}

PUT my_index/_doc/1 <2>
{
  "message": "Syntax error"
}

PUT my_index/_doc/2 <3>
{
  "message": "Syntax error with some long stacktrace"
}

GET _search <4>
{
  "aggs": {
    "messages": {
      "terms": {
        "field": "message"
      }
    }
  }
}
--------------------------------------------------
// CONSOLE
<1> 该字段将忽略任何超过 20 个字符的字符串。
<2> 该文档已成功编入索引。
<3> 该文档将被编入索引，但不对 `message` 字段编制索引。
<4> 搜索返回两个文档，但只有第一个文档存在于聚合中。

提示：可以使用 <<indices-put-mapping,PUT mapping API>> 在现有字段上更新 `ignore_above` 设置。

此选项对于防止 Lucene 的术语字节长度限制为 `32766` 也很有用。

注意： `ignore_above` 的值是 __字符计数__，但 Lucene 是计算字节数。你如果使用带有许多非 ASCII 字符的 UTF-8 文本，可能需要将限制设置为 `32766/4 = 8191` ，因为 UTF-8 字符最多可占用 4 个字节。
