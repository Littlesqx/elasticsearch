[[coerce]]
=== `coerce`

数据并不总是干净的。根据它的生成方式，可以在 JSON 体中将数字呈现为真正的 JSON 数，例如 `5` ，但它也可能呈现为字符串，例如 `"5"` 。
或者，应该是整数的数字可以替代地被渲染为浮点，例如， `5.0` ，甚至 `"5.0"` 。

强制（Coercion） 尝试清除脏值以适合字段的数据类型。例如：

* 字符串将被强制转换为数字。
* 浮点将被截断为整数值。

For instance:

[source,js]
--------------------------------------------------
PUT my_index
{
  "mappings": {
    "_doc": {
      "properties": {
        "number_one": {
          "type": "integer"
        },
        "number_two": {
          "type": "integer",
          "coerce": false
        }
      }
    }
  }
}

PUT my_index/_doc/1
{
  "number_one": "10" <1>
}

PUT my_index/_doc/2
{
  "number_two": "10" <2>
}
--------------------------------------------------
// CONSOLE
// TEST[catch:bad_request]
<1> `number_one` 字段将包含整数 `10` 。
<2> 该文件将被拒绝，因为禁用了 coercion。

提示：同一索引中同名字段的 `coerce` 设置不同是允许的。可以使用 <<indices-put-mapping,PUT mapping API>> 在现有字段上更新其值。

[[coerce-setting]]
==== Index-level 默认

可以在索引级别设置 `index.mapping.coerce` 设置，以在所有映射类型中全局禁用 coercion：

[source,js]
--------------------------------------------------
PUT my_index
{
  "settings": {
    "index.mapping.coerce": false
  },
  "mappings": {
    "_doc": {
      "properties": {
        "number_one": {
          "type": "integer",
          "coerce": true
        },
        "number_two": {
          "type": "integer"
        }
      }
    }
  }
}

PUT my_index/_doc/1
{ "number_one": "10" } <1>

PUT my_index/_doc/2
{ "number_two": "10" } <2>
--------------------------------------------------
// CONSOLE
// TEST[catch:bad_request]
<1> `number_one` 字段覆盖索引级别设置以启用 coercion。
<2> 此文档将被拒绝，因为 `number_two` 字段继承了索引级的 coercion 设置。
